{% extends 'questionic/layout.html' %}
{% block body %}

<div class="row g-0">
    <div class="col-3"></div>
    <div class="col-6">
        <br>
        <p>Questionic > ระดับ: {{question.grade}} > หมวดหมู่: {{question.category}} <p>
        <h1>{{question.title}}<h1>
        <h5>{{question.detail}}<h5>
        <br>
        {%for img in list_images %}
            <img src='{{img.image.url}}' class="img-thumbnail" width="400" height="600">
        {%endfor%}
        <br><br><br>
        
        <div style='display: flex;'>
            <img src="{{question.asker.image_profile.url}}" width="50" height="50">
            <h6>&nbsp {{question.asker}} <br>&nbsp {{question.date_asked}}</h6> 

        </div>
        <hr>
        
        <br><br><br><br>
        <h4>แสดงความคิดเห็น<h4>
        <br><br><br><br>
        
        {% if user.is_authenticated %}
            <div style='display: flex;'>
                <img src="{{myaccount.image_profile.url}}" width="50" height="50">
                <h6>&nbsp {{myaccount}}</h6> 
            </div>
            <div style="margin-left: 55px;">
                
                <form action="{% url 'questionic:question' question.id %}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <textarea class="form-control" rows = "5" cols = "50" name = "Detail" placeholder="เขียนความคิดเห็น" required></textarea>
                    <div class="invalid-feedback">
                        กรุณาเขียนความคิดเห็น
                    </div>
                    <input class="form-control" type="file" name="images" accept="image/png, image/jpeg" multiple>
                    <button class="btn btn-secondary btn-sm" type="submit" name="comment" value="{{question.id}}">ส่งความคิดเห็น</button>
                </form>
            </div>
        {% else %}
            <p>กรุณาเข้าสู่ระบบเพื่อเขียนความคิดเห็น</p>
        {% endif %}
        
        <br><br><br>
        <h4>ความคิดเห็น<h4>
        <br>
        {%for answer, image_answer in dict_answer_image.items %}
            <a style="color: #000;" href="{% url 'users:userprofile' answer.answerer %}">
                <div style='display: flex;'>
                    <img src="{{answer.answerer.image_profile.url}}" width="50" height="50">
                    <h6>&nbsp&nbsp{{answer.answerer}} &nbsp&nbsp&nbsp {{answer.date_answered}}<h6>
                </div>
            </a>

            <div style="margin-left: 55px;">
                <h5> {{answer.detail}}<h5>
                
                {%for image in image_answer%}
                    <img src='{{image.image.url}}' class="img-thumbnail" width="400" height="600">
                {%endfor%}
            </div>
            
            <br><br>
            {% if user.is_authenticated %}
            <button class="form-control" name="show_reply_button" onclick="show_reply('{{answer.id}}')">ตอบกลับ</button>
            {% else %}
            <p>กรุณาเข้าสู่ระบบเพื่อเขียนความคิดเห็น</p>
            {% endif %}
            
            <div style="margin-left: 75px;" hidden id='show_reply{{answer.id}}'>
                <div style='display: flex;'>
                    <img src="{{myaccount.image_profile.url}}" width="50" height="50">
                    <h6>&nbsp {{myaccount}}</h6> 
                </div>
                <div style="margin-left: 55px;">
                    <form action="{% url 'questionic:question' question.id %}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <textarea class="form-control" rows = "5" cols = "50" name = "Detail" placeholder="เขียนตอบกลับ" required></textarea>
                        <div class="invalid-feedback">
                            กรุณาเขียนตอบกลับ
                          </div>
                        <input class="form-control" type="file" name="images" accept="image/png, image/jpeg" multiple>
                        <button class="btn btn-secondary btn-sm" type="submit" name="reply" value="{{answer.id}}">ส่งตอบกลับ</button>
                    </form>
                </div>
            </div>
            <br>
            {%for ans, reply_answer_image in dict_reply_image.items %}
                {%if answer.id is ans.id %}
                    {%for reply, image_reply in reply_answer_image.items %}

                    <div style="margin-left: 75px;">
                        <a style="color: #000;" href="{% url 'users:userprofile' reply.reply_answerer %}">
                            <div style='display: flex;'>
                                <img src="{{reply.reply_answerer.image_profile.url}}" width="50" height="50">
                                <h6>&nbsp&nbsp {{reply.reply_answerer}} &nbsp&nbsp&nbsp {{reply.date_reply_answered}}<h6>
                            </div>
                        </a>
                        
                        <div style="margin-left: 55px;">
                            <h5>{{reply.detail}}<h5>
                            
                                {%for image in image_reply%}
                                <img src='{{image.image.url}}' class="img-thumbnail" width="400" height="600">
                            {%endfor%}
                        </div>
                    </div>
                    <br>
                    {%endfor%}
                {%endif%}
            {%endfor%}
        {%endfor%}



    </div>
    <div class="col-3"></div>
</div>


<script>
    function show_reply(id){
        let reply = document.getElementById("show_reply" + id);
        reply.hidden = false;
        console.log(id)
    }

    (() => {
        'use strict'
    
        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        const forms = document.querySelectorAll('.needs-validation')
    
        // Loop over them and prevent submission
        Array.from(forms).forEach(form => {
          form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }
    
            form.classList.add('was-validated')
          }, false)
        })
      })()
</script>


{% endblock %}